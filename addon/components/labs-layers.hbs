{{!-- We need to detect layer order so bind event to all mouse interactions--}}
{{maplibre-gl-on "mousemove" (action "handleLayerMouseMove")
  eventSource=map}}

{{!-- Bind layer groups" layers --}}
{{#each layers key="style" as |layerObject|}}
  {{maplibre-gl-layer
    map=map
    layer=layerObject.maplibreGlStyle
    before=layerObject.before
  }}
  {{!-- if the layer is hightlightable or tooltipable, bind events --}}
  {{#if (or layerObject.highlightable layerObject.tooltipable)}}
    {{maplibre-gl-on "mouseleave" layerObject.maplibreGlStyle.id (action "handleLayerMouseLeave")
      eventSource=map}}
  {{/if}}

  {{#if layerObject.clickable}}
    {{maplibre-gl-on "click" layerObject.maplibreGlStyle.id (action "handleLayerMouseClick")
      eventSource=map}}
  {{/if}}
{{/each}}

{{yield (hash
  tooltip=(if (and mousePosition hoveredFeature hoveredLayer.tooltipable)
    (component toolTipComponent
      feature=hoveredFeature
      layer=hoveredLayer
      mousePosition=mousePosition
      top=mousePosition.y
      left=mousePosition.x
    )
  )
)}}
